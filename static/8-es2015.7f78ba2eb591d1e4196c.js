(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{i1rK:function(e,t,n){"use strict";n.r(t),n.d(t,"NewAnalysisModule",(function(){return ce}));var i=n("ofXK"),s=n("tyNb"),o=n("3Pt+"),r=n("fXoL"),c=n("cn6w"),a=n("+rOU"),l=n("XNiG"),u=n("rDax"),h=n("JwMs"),b=n("/KA4"),p=n("1G5W"),d=n("pdGh"),g=n("FwiY"),m=n("GR68"),f=n("2Suw");function y(e,t){if(1&e){const e=r.Xb();r.Wb(0,"nz-message",2),r.ec("destroyed",(function(t){return r.wc(e),r.ic().remove(t.id,t.userAction)})),r.Vb()}2&e&&r.nc("instance",t.$implicit)}function v(e,t){1&e&&r.Rb(0,"i",10)}function z(e,t){1&e&&r.Rb(0,"i",11)}function C(e,t){1&e&&r.Rb(0,"i",12)}function w(e,t){1&e&&r.Rb(0,"i",13)}function T(e,t){1&e&&r.Rb(0,"i",14)}function x(e,t){if(1&e&&(r.Ub(0),r.Rb(1,"span",15),r.Tb()),2&e){const e=r.ic();r.Cb(1),r.nc("innerHTML",e.instance.content,r.xc)}}let S=0,O=(()=>{class e{constructor(e,t){this.cdr=e,this.nzConfigService=t,this.instances=[],this.destroy$=new l.a,this.updateConfig()}ngOnInit(){this.subscribeConfigChange()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}create(e){const t=this.onCreate(e);return this.instances.length>=this.config.nzMaxStack&&(this.instances=this.instances.slice(1)),this.instances=[...this.instances,t],this.readyInstances(),t}remove(e,t=!1){this.instances.some((n,i)=>n.messageId===e&&(this.instances.splice(i,1),this.instances=[...this.instances],this.onRemove(n,t),this.readyInstances(),!0))}removeAll(){this.instances.forEach(e=>this.onRemove(e,!1)),this.instances=[],this.readyInstances()}onCreate(e){return e.options=this.mergeOptions(e.options),e.onClose=new l.a,e}onRemove(e,t){e.onClose.next(t),e.onClose.complete()}readyInstances(){this.cdr.detectChanges()}mergeOptions(e){const{nzDuration:t,nzAnimate:n,nzPauseOnHover:i}=this.config;return Object.assign({nzDuration:t,nzAnimate:n,nzPauseOnHover:i},e)}}return e.\u0275fac=function(e){r.dc()},e.\u0275dir=r.Lb({type:e}),e})(),W=(()=>{class e{constructor(e){this.cdr=e,this.destroyed=new r.n,this.eraseTimer=null}ngOnInit(){this.options=this.instance.options,this.options.nzAnimate&&(this.instance.state="enter"),this.autoClose=this.options.nzDuration>0,this.autoClose&&(this.initErase(),this.startEraseTimeout())}ngOnDestroy(){this.autoClose&&this.clearEraseTimeout()}onEnter(){this.autoClose&&this.options.nzPauseOnHover&&(this.clearEraseTimeout(),this.updateTTL())}onLeave(){this.autoClose&&this.options.nzPauseOnHover&&this.startEraseTimeout()}destroy(e=!1){this.options.nzAnimate?(this.instance.state="leave",this.cdr.detectChanges(),setTimeout(()=>{this.destroyed.next({id:this.instance.messageId,userAction:e})},200)):this.destroyed.next({id:this.instance.messageId,userAction:e})}initErase(){this.eraseTTL=this.options.nzDuration,this.eraseTimingStart=Date.now()}updateTTL(){this.autoClose&&(this.eraseTTL-=Date.now()-this.eraseTimingStart)}startEraseTimeout(){this.eraseTTL>0?(this.clearEraseTimeout(),this.eraseTimer=setTimeout(()=>this.destroy(),this.eraseTTL),this.eraseTimingStart=Date.now()):this.destroy()}clearEraseTimeout(){null!==this.eraseTimer&&(clearTimeout(this.eraseTimer),this.eraseTimer=null)}}return e.\u0275fac=function(e){r.dc()},e.\u0275dir=r.Lb({type:e}),e})();const k={nzAnimate:!0,nzDuration:3e3,nzMaxStack:7,nzPauseOnHover:!0,nzTop:24};let V=(()=>{class e extends O{constructor(e,t){super(e,t),this.destroy$=new l.a,this.instances=[]}subscribeConfigChange(){this.nzConfigService.getConfigChangeEventForComponent("message").pipe(Object(p.a)(this.destroy$)).subscribe(()=>this.updateConfig())}updateConfig(){this.config=Object.assign(Object.assign(Object.assign({},k),this.config),this.nzConfigService.getConfigForComponent("message")),this.top=Object(b.j)(this.config.nzTop),this.cdr.markForCheck()}}return e.\u0275fac=function(t){return new(t||e)(r.Qb(r.h),r.Qb(f.a))},e.\u0275cmp=r.Kb({type:e,selectors:[["nz-message-container"]],exportAs:["nzMessageContainer"],features:[r.zb],decls:2,vars:3,consts:[[1,"ant-message"],[3,"instance","destroyed",4,"ngFor","ngForOf"],[3,"instance","destroyed"]],template:function(e,t){1&e&&(r.Wb(0,"div",0),r.Cc(1,y,1,1,"nz-message",1),r.Vb()),2&e&&(r.Bc("top",t.top),r.Cb(1),r.nc("ngForOf",t.instances))},directives:function(){return[i.j,j]},encapsulation:2,changeDetection:0}),e})(),M=(()=>{class e{}return e.\u0275mod=r.Ob({type:e}),e.\u0275inj=r.Nb({factory:function(t){return new(t||e)}}),e})(),I=(()=>{class e extends class{constructor(e,t,n){this.nzSingletonService=e,this.overlay=t,this.injector=n}remove(e){this.container&&(e?this.container.remove(e):this.container.removeAll())}getInstanceId(){return`${this.componentPrefix}-${S++}`}withContainer(e){let t=this.nzSingletonService.getSingletonWithKey(this.componentPrefix);if(t)return t;const n=this.overlay.create({hasBackdrop:!1,scrollStrategy:this.overlay.scrollStrategies.noop(),positionStrategy:this.overlay.position().global()}),i=new a.b(e,null,this.injector),s=n.attach(i);return n.overlayElement.style.zIndex="1010",t||(this.container=t=s.instance,this.nzSingletonService.registerSingletonWithKey(this.componentPrefix,t)),t}}{constructor(e,t,n){super(e,t,n),this.componentPrefix="message-"}success(e,t){return this.createInstance({type:"success",content:e},t)}error(e,t){return this.createInstance({type:"error",content:e},t)}info(e,t){return this.createInstance({type:"info",content:e},t)}warning(e,t){return this.createInstance({type:"warning",content:e},t)}loading(e,t){return this.createInstance({type:"loading",content:e},t)}create(e,t,n){return this.createInstance({type:e,content:t},n)}createInstance(e,t){return this.container=this.withContainer(V),this.container.create(Object.assign(Object.assign({},e),{createdAt:new Date,messageId:this.getInstanceId(),options:t}))}}return e.\u0275fac=function(t){return new(t||e)(r.ac(h.d),r.ac(u.d),r.ac(r.r))},e.\u0275prov=Object(r.Mb)({factory:function(){return new e(Object(r.ac)(h.d),Object(r.ac)(u.d),Object(r.ac)(r.o))},token:e,providedIn:M}),e})(),j=(()=>{class e extends W{constructor(e){super(e),this.destroyed=new r.n}}return e.\u0275fac=function(t){return new(t||e)(r.Qb(r.h))},e.\u0275cmp=r.Kb({type:e,selectors:[["nz-message"]],inputs:{instance:"instance"},outputs:{destroyed:"destroyed"},exportAs:["nzMessage"],features:[r.zb],decls:10,vars:9,consts:[[1,"ant-message-notice",3,"mouseenter","mouseleave"],[1,"ant-message-notice-content"],[1,"ant-message-custom-content",3,"ngClass"],[3,"ngSwitch"],["nz-icon","","nzType","check-circle",4,"ngSwitchCase"],["nz-icon","","nzType","info-circle",4,"ngSwitchCase"],["nz-icon","","nzType","exclamation-circle",4,"ngSwitchCase"],["nz-icon","","nzType","close-circle",4,"ngSwitchCase"],["nz-icon","","nzType","loading",4,"ngSwitchCase"],[4,"nzStringTemplateOutlet"],["nz-icon","","nzType","check-circle"],["nz-icon","","nzType","info-circle"],["nz-icon","","nzType","exclamation-circle"],["nz-icon","","nzType","close-circle"],["nz-icon","","nzType","loading"],[3,"innerHTML"]],template:function(e,t){1&e&&(r.Wb(0,"div",0),r.ec("mouseenter",(function(){return t.onEnter()}))("mouseleave",(function(){return t.onLeave()})),r.Wb(1,"div",1),r.Wb(2,"div",2),r.Ub(3,3),r.Cc(4,v,1,0,"i",4),r.Cc(5,z,1,0,"i",5),r.Cc(6,C,1,0,"i",6),r.Cc(7,w,1,0,"i",7),r.Cc(8,T,1,0,"i",8),r.Tb(),r.Cc(9,x,2,1,"ng-container",9),r.Vb(),r.Vb(),r.Vb()),2&e&&(r.nc("@moveUpMotion",t.instance.state),r.Cb(2),r.nc("ngClass","ant-message-"+t.instance.type),r.Cb(1),r.nc("ngSwitch",t.instance.type),r.Cb(1),r.nc("ngSwitchCase","success"),r.Cb(1),r.nc("ngSwitchCase","info"),r.Cb(1),r.nc("ngSwitchCase","warning"),r.Cb(1),r.nc("ngSwitchCase","error"),r.Cb(1),r.nc("ngSwitchCase","loading"),r.Cb(1),r.nc("nzStringTemplateOutlet",t.instance.content))},directives:[i.i,i.m,i.n,d.b,g.b],encapsulation:2,data:{animation:[m.c]},changeDetection:0}),e})(),P=(()=>{class e{}return e.\u0275mod=r.Ob({type:e}),e.\u0275inj=r.Nb({factory:function(t){return new(t||e)},imports:[[i.c,u.e,g.c,d.a,M]]}),e})();var E=n("ocnv"),_=n("B+r4"),B=n("PTRe"),A=n("OzZK"),L=n("mrSG"),F=n("RwU8"),N=n("C2AL");function R(e,t){1&e&&(r.Wb(0,"h3"),r.Ec(1,"Drag and drop a file or select add Image"),r.Vb())}function D(e,t){if(1&e){const e=r.Xb();r.Wb(0,"div"),r.Wb(1,"span",4),r.Ec(2),r.Vb(),r.Wb(3,"span",5),r.Ec(4),r.Vb(),r.Wb(5,"span",6),r.Wb(6,"button",7),r.ec("click",(function(){return r.wc(e),r.ic().removeFile()})),r.Rb(7,"i",8),r.Vb(),r.Vb(),r.Vb()}if(2&e){const e=r.ic();r.Cb(2),r.Gc(" ",e.filename," "),r.Cb(2),r.Gc("",e.fileSize,"MB"),r.Cb(2),r.nc("nzSize","small")}}let U=(()=>{class e{constructor(e,t){this.msg=e,this.commonApi=t,this.markers=new r.n,this.csvBlob=new r.n}postMethod(e){return Object(L.a)(this,void 0,void 0,(function*(){this.fileToUpload=e.item(0),this.filename=this.fileToUpload.name,this.fileSize=this.bytesToMegaBytes(this.fileToUpload.size);try{const e=yield this.commonApi.extractCsv(this.fileToUpload);this.msg.info("Successful csv upload"),this.markers.emit(e),this.csvBlob.emit(this.fileToUpload)}catch(t){this.msg.error("Error on upload"),console.log(t)}return!1}))}bytesToMegaBytes(e){return(9.5367431640625e-7*e).toFixed(2)}removeFile(){this.filename=null}}return e.\u0275fac=function(t){return new(t||e)(r.Qb(I),r.Qb(c.a))},e.\u0275cmp=r.Kb({type:e,selectors:[["app-tkn-upload"]],outputs:{markers:"markers",csvBlob:"csvBlob"},decls:5,vars:2,consts:[[1,"upload-wrap"],["id","myForm","type","file","name","file",1,"file-upload-input",3,"change"],[1,"drag-text"],[4,"ngIf"],[1,"filename"],[1,"filesize"],[1,"remove"],["nz-button","","nzType","primary",3,"nzSize","click"],["nz-icon","","nzType","close"]],template:function(e,t){1&e&&(r.Wb(0,"div",0),r.Wb(1,"input",1),r.ec("change",(function(e){return t.postMethod(e.target.files)})),r.Vb(),r.Wb(2,"div",2),r.Cc(3,R,2,0,"h3",3),r.Cc(4,D,8,3,"div",3),r.Vb(),r.Vb()),2&e&&(r.Cb(3),r.nc("ngIf",!t.filename),r.Cb(1),r.nc("ngIf",t.filename))},directives:[i.k,A.a,F.a,N.a,g.b],styles:["[_nghost-%COMP%]     .avatar-uploader>.ant-upload{width:128px;height:128px}.upload-wrap[_ngcontent-%COMP%]{margin-top:20px;position:relative;background:#f0eeee;border:1px solid #e3e1e1;height:150px;display:flex;justify-content:center;align-items:center}.upload-wrap[_ngcontent-%COMP%]:hover{background-color:#e4e4e4}.drag-text[_ngcontent-%COMP%]{text-align:center}.file-upload-input[_ngcontent-%COMP%]{position:absolute;margin:0;padding:0;width:100%;height:100%;outline:none;opacity:0;cursor:pointer}.filename[_ngcontent-%COMP%]{font-size:18px}.filesize[_ngcontent-%COMP%]{font-size:10px;font-style:italic;padding:0 5px}"]}),e})();var $=n("WlLC");function G(e,t){if(1&e){const e=r.Xb();r.Wb(0,"div",1),r.Wb(1,"div",2),r.Wb(2,"div"),r.Wb(3,"span",3),r.Ec(4,"Step 2:"),r.Vb(),r.Ec(5,"Please select the area by drawing a rectangle from the map toolbar. "),r.Vb(),r.Vb(),r.Wb(6,"app-tnk-maps",15),r.ec("boundingBox",(function(t){return r.wc(e),r.ic().getBoundingBox(t)})),r.Vb(),r.Vb()}if(2&e){const e=r.ic();r.Cb(6),r.nc("markers",e.markers)}}function K(e,t){if(1&e){const e=r.Xb();r.Wb(0,"button",16),r.ec("click",(function(){return r.wc(e),r.ic().startNewTask()})),r.Rb(1,"i",17),r.Ec(2,"Start new job\n"),r.Vb()}}const H=[{path:"",component:(()=>{class e{constructor(e,t,n){this.commonApi=e,this.msg=t,this.fb=n,this.loading=!1,this.boxes=[!0,!0,!0],this.showMapSelection=!1,this.markers=[],this.boundingBox=null,this.jobMeta={name:"this is a test",time:{submit:"12:38:00"},job_type:"pmedian",properties:{type:"geographic",cost_type:"time",demand_pts:{if_out_of_bounds:"exclude"},box:{sw:"52.25,-0.1",ne:"52.5,0.4",grid_height:"None",grid_length:10},p_val:{min:3,max:5}}}}ngOnInit(){this.validateForm=this.fb.group({userName:[null,[o.o.required]],password:[null,[o.o.required]],remember:[!0]})}getMarkers(e){this.csvMarkers=e,this.showMapSelection=!0,this.boundingBox=null,this.markers=e,this.loading=!0,setTimeout(()=>{this.boxes[0]=!1,this.loading=!1},500)}submitForm(){for(const e in this.validateForm.controls)this.validateForm.controls[e].markAsDirty(),this.validateForm.controls[e].updateValueAndValidity()}getCsvBlob(e){this.csv=e,console.log("csv blob"),console.log(e)}getBoundingBox(e){this.boundingBox=e}startNewTask(){const e={sw:null,ne:null,grid_height:null,grid_length:null},{_northEast:t,_southWest:n}=this.boundingBox;e.sw=`${n.lat},${n.lng}`,e.ne=`${t.lat},${t.lng}`,e.grid_height="None",e.grid_length=10,this.jobMeta.properties.box=e,console.log(this.jobMeta),this.commonApi.newTask(this.csv,JSON.stringify(this.jobMeta)).then(e=>{this.msg.info("Job started"),console.log("api success",e)}).catch(e=>{this.msg.error("Error starting new job"),console.log("api error",e)})}}return e.\u0275fac=function(t){return new(t||e)(r.Qb(c.a),r.Qb(I),r.Qb(o.d))},e.\u0275cmp=r.Kb({type:e,selectors:[["app-new-analysis"]],decls:29,vars:5,consts:[["id","new-analysis"],[1,"box","border","shadow"],[1,"step"],[1,"highlight"],[3,"markers","csvBlob"],["class","box border shadow",4,"ngIf"],["nz-form","",3,"nzLayout","formGroup","ngSubmit"],["nzErrorTip","Please input your username!"],["nzPrefixIcon","user"],["formControlName","userName","nz-input","","placeholder","Username"],["nzErrorTip","Please input your Password!"],["nzPrefixIcon","lock"],["formControlName","password","nz-input","","type","password","placeholder","Password"],["nz-button","","nzType","primary",3,"disabled"],["nz-button","","nzType","primary",3,"click",4,"ngIf"],[3,"markers","boundingBox"],["nz-button","","nzType","primary",3,"click"],["nz-icon","","nzType","enter"]],template:function(e,t){1&e&&(r.Wb(0,"div",0),r.Wb(1,"div",1),r.Wb(2,"div",2),r.Wb(3,"div"),r.Wb(4,"span",3),r.Ec(5,"Step 1"),r.Vb(),r.Ec(6,": Please upload a csv file. "),r.Vb(),r.Vb(),r.Wb(7,"app-tkn-upload",4),r.ec("markers",(function(e){return t.getMarkers(e)}))("csvBlob",(function(e){return t.getCsvBlob(e)})),r.Vb(),r.Vb(),r.Cc(8,G,7,1,"div",5),r.Wb(9,"div",1),r.Wb(10,"div",2),r.Wb(11,"div"),r.Wb(12,"span",3),r.Ec(13,"Step 3:"),r.Vb(),r.Ec(14,"Please fill all required fields. "),r.Vb(),r.Vb(),r.Wb(15,"form",6),r.ec("ngSubmit",(function(){return t.submitForm()})),r.Wb(16,"nz-form-item"),r.Wb(17,"nz-form-control",7),r.Wb(18,"nz-input-group",8),r.Rb(19,"input",9),r.Vb(),r.Vb(),r.Vb(),r.Wb(20,"nz-form-item"),r.Wb(21,"nz-form-control",10),r.Wb(22,"nz-input-group",11),r.Rb(23,"input",12),r.Vb(),r.Vb(),r.Vb(),r.Wb(24,"nz-form-item"),r.Wb(25,"nz-form-control"),r.Wb(26,"button",13),r.Ec(27," Log in "),r.Vb(),r.Vb(),r.Vb(),r.Vb(),r.Vb(),r.Vb(),r.Cc(28,K,3,0,"button",14)),2&e&&(r.Cb(8),r.nc("ngIf",t.showMapSelection),r.Cb(7),r.nc("nzLayout","inline")("formGroup",t.validateForm),r.Cb(11),r.nc("disabled",!t.validateForm.valid),r.Cb(2),r.nc("ngIf",t.markers.length>0&&t.boundingBox))},directives:[U,i.k,o.p,o.l,E.b,o.g,_.c,E.c,_.a,E.a,B.b,o.c,B.a,o.k,o.f,A.a,F.a,N.a,$.a,g.b],styles:["#new-analysis[_ngcontent-%COMP%]   .step[_ngcontent-%COMP%]{font-weight:400;margin-bottom:40px;display:flex;justify-content:space-between;align-items:center}#new-analysis[_ngcontent-%COMP%]   .step[_ngcontent-%COMP%]   .highlight[_ngcontent-%COMP%]{font-weight:600}"]}),e})()}];let J=(()=>{class e{}return e.\u0275mod=r.Ob({type:e}),e.\u0275inj=r.Nb({factory:function(t){return new(t||e)},imports:[[s.f.forChild(H)],s.f]}),e})();var Q=n("xVJt"),X=(n("FtGj"),n("tk/3"),n("79xS"),n("LRne"),n("HDdC"),n("quSY"),n("eIep"),n("lJxs"),n("pLZG"),n("R0Ic"),n("nLfN")),q=n("Rm4T");let Y=(()=>{class e{}return e.\u0275mod=r.Ob({type:e}),e.\u0275inj=r.Nb({factory:function(t){return new(t||e)},imports:[[i.c,g.c,d.a]]}),e})();var Z=n("YF2q"),ee=n("JgHy");n("/uUt");let te=(()=>{class e{}return e.\u0275mod=r.Ob({type:e}),e.\u0275inj=r.Nb({factory:function(t){return new(t||e)},imports:[[i.c,u.e,d.a,ee.c,Z.b]]}),e})(),ne=(()=>{class e{}return e.\u0275mod=r.Ob({type:e}),e.\u0275inj=r.Nb({factory:function(t){return new(t||e)},imports:[[i.c,o.h,X.b,te,Y,q.b,g.c]]}),e})();var ie=n("CSM4");let se=(()=>{class e{}return e.\u0275mod=r.Ob({type:e}),e.\u0275inj=r.Nb({factory:function(t){return new(t||e)},imports:[[i.c,ne,P,ie.a]]}),e})();var oe=n("pKmL"),re=n("UPf0");let ce=(()=>{class e{}return e.\u0275mod=r.Ob({type:e}),e.\u0275inj=r.Nb({factory:function(t){return new(t||e)},imports:[[i.c,J,Q.a,se,ie.a,oe.a,re.a]]}),e})()}}]);