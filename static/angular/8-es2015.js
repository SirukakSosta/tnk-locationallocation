(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{i1rK:function(e,t,n){"use strict";n.r(t),n.d(t,"NewAnalysisModule",(function(){return ie}));var s=n("ofXK"),i=n("tyNb"),o=n("fXoL"),c=n("cn6w"),r=n("+rOU"),a=n("XNiG"),l=n("rDax"),h=n("JwMs"),u=n("/KA4"),p=n("1G5W"),b=n("pdGh"),g=n("FwiY"),d=n("GR68"),m=n("2Suw");function f(e,t){if(1&e){const e=o.Xb();o.Wb(0,"nz-message",2),o.ec("destroyed",(function(t){return o.wc(e),o.ic().remove(t.id,t.userAction)})),o.Vb()}2&e&&o.nc("instance",t.$implicit)}function y(e,t){1&e&&o.Rb(0,"i",10)}function C(e,t){1&e&&o.Rb(0,"i",11)}function v(e,t){1&e&&o.Rb(0,"i",12)}function w(e,t){1&e&&o.Rb(0,"i",13)}function z(e,t){1&e&&o.Rb(0,"i",14)}function T(e,t){if(1&e&&(o.Ub(0),o.Rb(1,"span",15),o.Tb()),2&e){const e=o.ic();o.Cb(1),o.nc("innerHTML",e.instance.content,o.xc)}}let x=0,O=(()=>{class e{constructor(e,t){this.cdr=e,this.nzConfigService=t,this.instances=[],this.destroy$=new a.a,this.updateConfig()}ngOnInit(){this.subscribeConfigChange()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}create(e){const t=this.onCreate(e);return this.instances.length>=this.config.nzMaxStack&&(this.instances=this.instances.slice(1)),this.instances=[...this.instances,t],this.readyInstances(),t}remove(e,t=!1){this.instances.some((n,s)=>n.messageId===e&&(this.instances.splice(s,1),this.instances=[...this.instances],this.onRemove(n,t),this.readyInstances(),!0))}removeAll(){this.instances.forEach(e=>this.onRemove(e,!1)),this.instances=[],this.readyInstances()}onCreate(e){return e.options=this.mergeOptions(e.options),e.onClose=new a.a,e}onRemove(e,t){e.onClose.next(t),e.onClose.complete()}readyInstances(){this.cdr.detectChanges()}mergeOptions(e){const{nzDuration:t,nzAnimate:n,nzPauseOnHover:s}=this.config;return Object.assign({nzDuration:t,nzAnimate:n,nzPauseOnHover:s},e)}}return e.\u0275fac=function(e){o.dc()},e.\u0275dir=o.Lb({type:e}),e})(),S=(()=>{class e{constructor(e){this.cdr=e,this.destroyed=new o.n,this.eraseTimer=null}ngOnInit(){this.options=this.instance.options,this.options.nzAnimate&&(this.instance.state="enter"),this.autoClose=this.options.nzDuration>0,this.autoClose&&(this.initErase(),this.startEraseTimeout())}ngOnDestroy(){this.autoClose&&this.clearEraseTimeout()}onEnter(){this.autoClose&&this.options.nzPauseOnHover&&(this.clearEraseTimeout(),this.updateTTL())}onLeave(){this.autoClose&&this.options.nzPauseOnHover&&this.startEraseTimeout()}destroy(e=!1){this.options.nzAnimate?(this.instance.state="leave",this.cdr.detectChanges(),setTimeout(()=>{this.destroyed.next({id:this.instance.messageId,userAction:e})},200)):this.destroyed.next({id:this.instance.messageId,userAction:e})}initErase(){this.eraseTTL=this.options.nzDuration,this.eraseTimingStart=Date.now()}updateTTL(){this.autoClose&&(this.eraseTTL-=Date.now()-this.eraseTimingStart)}startEraseTimeout(){this.eraseTTL>0?(this.clearEraseTimeout(),this.eraseTimer=setTimeout(()=>this.destroy(),this.eraseTTL),this.eraseTimingStart=Date.now()):this.destroy()}clearEraseTimeout(){null!==this.eraseTimer&&(clearTimeout(this.eraseTimer),this.eraseTimer=null)}}return e.\u0275fac=function(e){o.dc()},e.\u0275dir=o.Lb({type:e}),e})();const k={nzAnimate:!0,nzDuration:3e3,nzMaxStack:7,nzPauseOnHover:!0,nzTop:24};let M=(()=>{class e extends O{constructor(e,t){super(e,t),this.destroy$=new a.a,this.instances=[]}subscribeConfigChange(){this.nzConfigService.getConfigChangeEventForComponent("message").pipe(Object(p.a)(this.destroy$)).subscribe(()=>this.updateConfig())}updateConfig(){this.config=Object.assign(Object.assign(Object.assign({},k),this.config),this.nzConfigService.getConfigForComponent("message")),this.top=Object(u.j)(this.config.nzTop),this.cdr.markForCheck()}}return e.\u0275fac=function(t){return new(t||e)(o.Qb(o.h),o.Qb(m.a))},e.\u0275cmp=o.Kb({type:e,selectors:[["nz-message-container"]],exportAs:["nzMessageContainer"],features:[o.zb],decls:2,vars:3,consts:[[1,"ant-message"],[3,"instance","destroyed",4,"ngFor","ngForOf"],[3,"instance","destroyed"]],template:function(e,t){1&e&&(o.Wb(0,"div",0),o.Cc(1,f,1,1,"nz-message",1),o.Vb()),2&e&&(o.Bc("top",t.top),o.Cb(1),o.nc("ngForOf",t.instances))},directives:function(){return[s.j,W]},encapsulation:2,changeDetection:0}),e})(),j=(()=>{class e{}return e.\u0275mod=o.Ob({type:e}),e.\u0275inj=o.Nb({factory:function(t){return new(t||e)}}),e})(),I=(()=>{class e extends class{constructor(e,t,n){this.nzSingletonService=e,this.overlay=t,this.injector=n}remove(e){this.container&&(e?this.container.remove(e):this.container.removeAll())}getInstanceId(){return`${this.componentPrefix}-${x++}`}withContainer(e){let t=this.nzSingletonService.getSingletonWithKey(this.componentPrefix);if(t)return t;const n=this.overlay.create({hasBackdrop:!1,scrollStrategy:this.overlay.scrollStrategies.noop(),positionStrategy:this.overlay.position().global()}),s=new r.b(e,null,this.injector),i=n.attach(s);return n.overlayElement.style.zIndex="1010",t||(this.container=t=i.instance,this.nzSingletonService.registerSingletonWithKey(this.componentPrefix,t)),t}}{constructor(e,t,n){super(e,t,n),this.componentPrefix="message-"}success(e,t){return this.createInstance({type:"success",content:e},t)}error(e,t){return this.createInstance({type:"error",content:e},t)}info(e,t){return this.createInstance({type:"info",content:e},t)}warning(e,t){return this.createInstance({type:"warning",content:e},t)}loading(e,t){return this.createInstance({type:"loading",content:e},t)}create(e,t,n){return this.createInstance({type:e,content:t},n)}createInstance(e,t){return this.container=this.withContainer(M),this.container.create(Object.assign(Object.assign({},e),{createdAt:new Date,messageId:this.getInstanceId(),options:t}))}}return e.\u0275fac=function(t){return new(t||e)(o.ac(h.d),o.ac(l.d),o.ac(o.r))},e.\u0275prov=Object(o.Mb)({factory:function(){return new e(Object(o.ac)(h.d),Object(o.ac)(l.d),Object(o.ac)(o.o))},token:e,providedIn:j}),e})(),W=(()=>{class e extends S{constructor(e){super(e),this.destroyed=new o.n}}return e.\u0275fac=function(t){return new(t||e)(o.Qb(o.h))},e.\u0275cmp=o.Kb({type:e,selectors:[["nz-message"]],inputs:{instance:"instance"},outputs:{destroyed:"destroyed"},exportAs:["nzMessage"],features:[o.zb],decls:10,vars:9,consts:[[1,"ant-message-notice",3,"mouseenter","mouseleave"],[1,"ant-message-notice-content"],[1,"ant-message-custom-content",3,"ngClass"],[3,"ngSwitch"],["nz-icon","","nzType","check-circle",4,"ngSwitchCase"],["nz-icon","","nzType","info-circle",4,"ngSwitchCase"],["nz-icon","","nzType","exclamation-circle",4,"ngSwitchCase"],["nz-icon","","nzType","close-circle",4,"ngSwitchCase"],["nz-icon","","nzType","loading",4,"ngSwitchCase"],[4,"nzStringTemplateOutlet"],["nz-icon","","nzType","check-circle"],["nz-icon","","nzType","info-circle"],["nz-icon","","nzType","exclamation-circle"],["nz-icon","","nzType","close-circle"],["nz-icon","","nzType","loading"],[3,"innerHTML"]],template:function(e,t){1&e&&(o.Wb(0,"div",0),o.ec("mouseenter",(function(){return t.onEnter()}))("mouseleave",(function(){return t.onLeave()})),o.Wb(1,"div",1),o.Wb(2,"div",2),o.Ub(3,3),o.Cc(4,y,1,0,"i",4),o.Cc(5,C,1,0,"i",5),o.Cc(6,v,1,0,"i",6),o.Cc(7,w,1,0,"i",7),o.Cc(8,z,1,0,"i",8),o.Tb(),o.Cc(9,T,2,1,"ng-container",9),o.Vb(),o.Vb(),o.Vb()),2&e&&(o.nc("@moveUpMotion",t.instance.state),o.Cb(2),o.nc("ngClass","ant-message-"+t.instance.type),o.Cb(1),o.nc("ngSwitch",t.instance.type),o.Cb(1),o.nc("ngSwitchCase","success"),o.Cb(1),o.nc("ngSwitchCase","info"),o.Cb(1),o.nc("ngSwitchCase","warning"),o.Cb(1),o.nc("ngSwitchCase","error"),o.Cb(1),o.nc("ngSwitchCase","loading"),o.Cb(1),o.nc("nzStringTemplateOutlet",t.instance.content))},directives:[s.i,s.m,s.n,b.b,g.b],encapsulation:2,data:{animation:[d.b]},changeDetection:0}),e})(),V=(()=>{class e{}return e.\u0275mod=o.Ob({type:e}),e.\u0275inj=o.Nb({factory:function(t){return new(t||e)},imports:[[s.c,l.e,g.c,b.a,j]]}),e})();var _=n("OzZK"),E=n("mrSG"),P=n("RwU8"),B=n("C2AL");function A(e,t){1&e&&(o.Wb(0,"h3"),o.Ec(1,"Drag and drop a file or select add Image"),o.Vb())}function L(e,t){if(1&e){const e=o.Xb();o.Wb(0,"div"),o.Wb(1,"span",4),o.Ec(2),o.Vb(),o.Wb(3,"span",5),o.Ec(4),o.Vb(),o.Wb(5,"span",6),o.Wb(6,"button",7),o.ec("click",(function(){return o.wc(e),o.ic().removeFile()})),o.Rb(7,"i",8),o.Vb(),o.Vb(),o.Vb()}if(2&e){const e=o.ic();o.Cb(2),o.Gc(" ",e.filename," "),o.Cb(2),o.Gc("",e.fileSize,"MB"),o.Cb(2),o.nc("nzSize","small")}}let N=(()=>{class e{constructor(e,t){this.msg=e,this.commonApi=t,this.markers=new o.n,this.csvBlob=new o.n}postMethod(e){return Object(E.a)(this,void 0,void 0,(function*(){this.fileToUpload=e.item(0),this.filename=this.fileToUpload.name,this.fileSize=this.bytesToMegaBytes(this.fileToUpload.size);try{const e=yield this.commonApi.extractCsv(this.fileToUpload);this.msg.info("Successful csv upload"),this.markers.emit(e),this.csvBlob.emit(this.fileToUpload)}catch(t){this.msg.error("Error on upload"),console.log(t)}return!1}))}bytesToMegaBytes(e){return(9.5367431640625e-7*e).toFixed(2)}removeFile(){this.filename=null}}return e.\u0275fac=function(t){return new(t||e)(o.Qb(I),o.Qb(c.a))},e.\u0275cmp=o.Kb({type:e,selectors:[["app-tkn-upload"]],outputs:{markers:"markers",csvBlob:"csvBlob"},decls:5,vars:2,consts:[[1,"upload-wrap"],["id","myForm","type","file","name","file",1,"file-upload-input",3,"change"],[1,"drag-text"],[4,"ngIf"],[1,"filename"],[1,"filesize"],[1,"remove"],["nz-button","","nzType","primary",3,"nzSize","click"],["nz-icon","","nzType","close"]],template:function(e,t){1&e&&(o.Wb(0,"div",0),o.Wb(1,"input",1),o.ec("change",(function(e){return t.postMethod(e.target.files)})),o.Vb(),o.Wb(2,"div",2),o.Cc(3,A,2,0,"h3",3),o.Cc(4,L,8,3,"div",3),o.Vb(),o.Vb()),2&e&&(o.Cb(3),o.nc("ngIf",!t.filename),o.Cb(1),o.nc("ngIf",t.filename))},directives:[s.k,_.a,P.a,B.a,g.b],styles:["[_nghost-%COMP%]     .avatar-uploader>.ant-upload{width:128px;height:128px}.upload-wrap[_ngcontent-%COMP%]{margin-top:20px;position:relative;background:#f0eeee;border:1px solid #e3e1e1;height:150px;display:flex;justify-content:center;align-items:center}.upload-wrap[_ngcontent-%COMP%]:hover{background-color:#e4e4e4}.drag-text[_ngcontent-%COMP%]{text-align:center}.file-upload-input[_ngcontent-%COMP%]{position:absolute;margin:0;padding:0;width:100%;height:100%;outline:none;opacity:0;cursor:pointer}.filename[_ngcontent-%COMP%]{font-size:18px}.filesize[_ngcontent-%COMP%]{font-size:10px;font-style:italic;padding:0 5px}"]}),e})();var D=n("WlLC");function R(e,t){if(1&e){const e=o.Xb();o.Wb(0,"div",1),o.Wb(1,"div",2),o.Wb(2,"div"),o.Wb(3,"span",3),o.Ec(4,"Step 2"),o.Vb(),o.Ec(5,": Please select the area by drawing a rectangle from the map toolbar. "),o.Vb(),o.Vb(),o.Wb(6,"app-tnk-maps",7),o.ec("boundingBox",(function(t){return o.wc(e),o.ic().getBoundingBox(t)})),o.Vb(),o.Vb()}if(2&e){const e=o.ic();o.Cb(6),o.nc("markers",e.markers)}}function F(e,t){if(1&e){const e=o.Xb();o.Wb(0,"button",8),o.ec("click",(function(){return o.wc(e),o.ic().startNewTask()})),o.Rb(1,"i",9),o.Ec(2,"Start new job\n"),o.Vb()}}const U=[{path:"",component:(()=>{class e{constructor(e,t){this.commonApi=e,this.msg=t,this.loading=!1,this.boxes=[!0,!0,!0],this.showMapSelection=!1,this.markers=[],this.boundingBox=null,this.jobMeta={name:"this is a test",time:{submit:"12:38:00"},job_type:"pmedian",properties:{type:"geographic",cost_type:"time",demand_pts:{if_out_of_bounds:"exclude"},box:{sw:"52.25,-0.1",ne:"52.5,0.4",grid_height:"None",grid_length:10},p_val:{min:3,max:5}}}}ngOnInit(){}getMarkers(e){this.csvMarkers=e,this.showMapSelection=!0,this.boundingBox=null,this.markers=e,this.loading=!0,setTimeout(()=>{this.boxes[0]=!1,this.loading=!1},500)}getCsvBlob(e){this.csv=e,console.log("csv blob"),console.log(e)}getBoundingBox(e){this.boundingBox=e}startNewTask(){const e={sw:null,ne:null,grid_height:null,grid_length:null},{_northEast:t,_southWest:n}=this.boundingBox;e.sw=`${n.lat},${n.lng}`,e.ne=`${t.lat},${t.lng}`,e.grid_height="None",e.grid_length=10,this.jobMeta.properties.box=e,console.log(this.jobMeta),this.commonApi.newTask(this.csv,JSON.stringify(this.jobMeta)).then(e=>{this.msg.info("Job started"),console.log("api success",e)}).catch(e=>{this.msg.error("Error starting new job"),console.log("api error",e)})}}return e.\u0275fac=function(t){return new(t||e)(o.Qb(c.a),o.Qb(I))},e.\u0275cmp=o.Kb({type:e,selectors:[["app-new-analysis"]],decls:10,vars:2,consts:[["id","new-analysis"],[1,"box","border","shadow"],[1,"step"],[1,"highlight"],[3,"markers","csvBlob"],["class","box border shadow",4,"ngIf"],["nz-button","","nzType","primary",3,"click",4,"ngIf"],[3,"markers","boundingBox"],["nz-button","","nzType","primary",3,"click"],["nz-icon","","nzType","enter"]],template:function(e,t){1&e&&(o.Wb(0,"div",0),o.Wb(1,"div",1),o.Wb(2,"div",2),o.Wb(3,"div"),o.Wb(4,"span",3),o.Ec(5,"Step 1"),o.Vb(),o.Ec(6,": Please upload a csv file. "),o.Vb(),o.Vb(),o.Wb(7,"app-tkn-upload",4),o.ec("markers",(function(e){return t.getMarkers(e)}))("csvBlob",(function(e){return t.getCsvBlob(e)})),o.Vb(),o.Vb(),o.Cc(8,R,7,1,"div",5),o.Vb(),o.Cc(9,F,3,0,"button",6)),2&e&&(o.Cb(8),o.nc("ngIf",t.showMapSelection),o.Cb(1),o.nc("ngIf",t.markers.length>0&&t.boundingBox))},directives:[N,s.k,D.a,_.a,P.a,B.a,g.b],styles:["#new-analysis[_ngcontent-%COMP%]   .step[_ngcontent-%COMP%]{font-weight:400;margin-bottom:40px;display:flex;justify-content:space-between;align-items:center}#new-analysis[_ngcontent-%COMP%]   .step[_ngcontent-%COMP%]   .highlight[_ngcontent-%COMP%]{font-weight:600}"]}),e})()}];let $=(()=>{class e{}return e.\u0275mod=o.Ob({type:e}),e.\u0275inj=o.Nb({factory:function(t){return new(t||e)},imports:[[i.f.forChild(U)],i.f]}),e})();var K=n("xVJt"),G=(n("FtGj"),n("tk/3"),n("79xS"),n("LRne"),n("HDdC"),n("quSY"),n("eIep"),n("lJxs"),n("pLZG"),n("R0Ic"),n("nLfN")),H=n("Rm4T"),J=n("3Pt+");let Q=(()=>{class e{}return e.\u0275mod=o.Ob({type:e}),e.\u0275inj=o.Nb({factory:function(t){return new(t||e)},imports:[[s.c,g.c,b.a]]}),e})();var X=n("YF2q"),Y=n("JgHy");n("/uUt");let q=(()=>{class e{}return e.\u0275mod=o.Ob({type:e}),e.\u0275inj=o.Nb({factory:function(t){return new(t||e)},imports:[[s.c,l.e,b.a,Y.c,X.b]]}),e})(),Z=(()=>{class e{}return e.\u0275mod=o.Ob({type:e}),e.\u0275inj=o.Nb({factory:function(t){return new(t||e)},imports:[[s.c,J.c,G.b,q,Q,H.b,g.c]]}),e})();var ee=n("CSM4");let te=(()=>{class e{}return e.\u0275mod=o.Ob({type:e}),e.\u0275inj=o.Nb({factory:function(t){return new(t||e)},imports:[[s.c,Z,V,ee.a]]}),e})();var ne=n("pKmL"),se=n("UPf0");let ie=(()=>{class e{}return e.\u0275mod=o.Ob({type:e}),e.\u0275inj=o.Nb({factory:function(t){return new(t||e)},imports:[[s.c,$,K.a,te,ee.a,ne.a,se.a]]}),e})()}}]);